(function(d){var r=function(a,c){var f={0:"",1:"",2:"<span>\u63a5\u53e3\u5f02\u5e38</span>",3:"<span>\u6570\u636e\u52a0\u8f7d\u5b8c\u6210</span>",4:"<span>\u914d\u7f6e\u4e0d\u5b8c\u5584</span>"};return function(e){c&&console&&console.log(e);1==e?d(a).removeClass("top").addClass("bottom").show():2==e?d(a).html(f[e]):3==e?d(a).html(f[e]).show():4==e?d(a).html(f[e]).show():a.hide()}},s=function(a,c,f){var e,b;b=d.extend({cols:2,colspan:10,width:230,debug:!1,backtotop:"#BackToTop",notice:"#loadingPins"},
a);(function(b){e=c.width();b.debug&&console&&console.log("width"+e);b.min_width=b.col*(b.width+10);b.debug&&console&&console.log("\u6700\u5c0f\u5bbd\u5ea6 "+b.min_width);e>b.min_width&&(b.cols=Math.floor(e/b.width),b.colspan=Math.floor((e-b.cols*b.width)/(b.cols-1)));d(b.notice).show();return b})(b);b.debug&&console&&console.dir(b);b.debug&&console&&console.log("\u5b9e\u9645\u5217 "+b.cols);b.debug&&console&&console.log("\u5b9e\u9645\u5217\u95f4\u8ddd "+b.colspan);var p={start:function(){var a=this;
d(window).bind("scroll",function(){var e=d(window).scrollTop();b.debug&&console&&console.log("scroll top:"+e);var m=c.height();b.debug&&console&&console.log("exper height:"+m);var g=d(window).height();b.debug&&console&&console.log("window height:"+g);20>m-(e+g)&&(b.debug&&console&&console.log("i am here "),f(1),b.getImageData(n),a.pause())})},pause:function(){d(window).unbind("scroll")}},q=new function(){var a=[];(function(){for(var c=0;c<b.cols;c++)a[c]=0})();b.debug&&console&&console.log("init array"+
a);var e=function(){for(var c=0,d=0;d<b.cols;d++)a[d]<a[c]&&(c=d);return c},f=function(){for(var c=0,d=0;d<b.cols;d++)a[d]>c&&(c=a[d]);return c+46};return{readyImage:function(g){g&&(d.each(g,function(d,h){h.col=e();h.top=a[h.col];h.left=h.col*(b.width+b.colspan);h.height=h.img_height+42;h.data_col="data_col_"+h.col;h.data_id="data_"+h.top+h.left;var g=h.height;a[h.col]+=g+30;c.css({height:f()})}),g=b.renderItemHtml(g),c.append(g))},reflow:function(){var g=b.cols,k=b.colspan;b.debug&&console&&console.log("new colspan: "+
k);for(k=0;k<g;k++)a[k]=0;c.children().each(function(c,f){var g=d(f),l=g.css("height"),l=l.replace("px",""),l=parseInt(l),k=e(),m=k*(b.width+b.colspan),n=a[k];b.debug&&console&&console.log("id:"+c+" col:"+k+" left: "+m+"top: "+n+" height="+l);g.css({left:m,top:n});g=l+30;a[k]+=g});c.css({height:f()})}}},n=function(a,c){this.end=function(){b.debug&&console&&console.log("i am ending");p.pause()};c?a?(d(b.notice).hide(),d(b.backtotop).show(),q.readyImage(a),p.start()):(f(2),this.end()):(f(3),this.end())};
b.getImageData(n);d(window).resize(function(){var a=c.width();b.debug&&console&&console.log("new width "+a);var e={};a>b.min_width&&(e.cols=Math.floor(a/b.width),e.colspan=Math.floor((a-b.cols*b.width)/(b.cols-1)));b.debug&&console&&console.log(e);b=d.extend(b,e);b.debug&&console&&console.dir(b);q.reflow()});d(b.backtotop).bind("click",function(){d(b.backtotop).scrollTop(0)})};d.WaterFall=function(a,c,f){d.data(c,"WaterFall",new s(a,c,f));return c};d.fn.WaterFall=function(a){var c;c=!1;"object"!==
typeof a&&(a.debug&&console&&console.log("bug in here!"),c=!0);!a.hasOwnProperty("getImageData")&&(a.hasOwnProperty("col")&&a.hasOwnProperty("width")&&a.hasOwnProperty("colspan"))&&(a.debug&&console&&console.log("bug in here!"),c=!0);"function"!==typeof a.getImageData&&(a.debug&&console&&console.log("bug in here!"),c=!0);if("number"!==typeof a.col||0==a.col)a.debug&&console&&console.log("bug in here!"),c=!0;if("number"!==typeof a.width||0==a.width)a.debug&&console&&console.log("bug in here!"),c=!0;
if("number"!==typeof a.colspan||0==a.colspan)a.debug&&console&&console.log("bug in here!"),c=!0;if("string"!==typeof a.backtotop||!/^\#/.test(a.backtotop))a.debug&&console&&console.log("bug in here!"),c=!0;if("string"!==typeof a.notice||!/^\#/.test(a.notice))a.debug&&console&&console.log("bug in here!"),c=!0;var f=new r(a.notice,a.debug);c?f(4):d.WaterFall(a,this,f)}})(jQuery);
